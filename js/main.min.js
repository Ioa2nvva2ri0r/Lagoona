"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function elemVisible(e,t,n){e.style.display=n,e.classList.add(t)}function elemHidden(e,t,n,o){void 0!==t&&e.classList.remove(t),e.classList.add(n),setTimeout((function(){e.style.display="none",e.classList.remove(n)}),o)}var tourInputValue,menu=document.getElementById("menu"),menuOpen=document.getElementById("menu-open"),menuClose=document.getElementById("menu-close");function hiddenMenu(){document.body.addEventListener("click",(function(e){if(window.screen.width<=820){if("none"===menu.style.display)return;menu.contains(e.target)||menuOpen.contains(e.target)||elemHidden(menu,"header__nav-open","header__nav-close",395)}else menu.style.display="flex"}))}menuOpen.addEventListener("click",(function(){return elemVisible(menu,"header__nav-open","flex")})),menuClose.addEventListener("click",(function(){return elemHidden(menu,"header__nav-open","header__nav-close",395)})),window.addEventListener("load",(function(){return hiddenMenu()})),window.addEventListener("resize",(function(){return hiddenMenu()})),document.querySelectorAll("#tourists, #nights, #date").forEach((function(e){e.addEventListener("input",(function(){this.value=this.value.replace("date"===e.id?/[^0-9.]/g:/[^0-9]/g,""),this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength))}))}));var dropdownOpen="tour__form-dropdown-open",dropdownClose="tour__form-dropdown-close",selectActive="tour__form-dropdown-select-active";document.querySelectorAll(".tour__form-dropdown-select").forEach((function(e){var t,n=_createForOfIteratorHelper(e.parentElement.children);try{var o=function(){var n=t.value;if(n.classList.contains("tour__form-dropdown")){e.addEventListener("click",(function(){this.classList.contains(selectActive)?(this.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)):(this.classList.add(selectActive),elemVisible(n,dropdownOpen,"flex"))}));var o,r=_createForOfIteratorHelper(n.children);try{for(r.s();!(o=r.n()).done;){o.value.addEventListener("click",(function(t){var o,r=_createForOfIteratorHelper(e.children);try{for(r.s();!(o=r.n()).done;){var i=o.value;"INPUT"===i.nodeName&&(tourInputValue=i.value,i.value=t.currentTarget.textContent,t.currentTarget.textContent=tourInputValue)}}catch(e){r.e(e)}finally{r.f()}e.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)}))}}catch(e){r.e(e)}finally{r.f()}document.body.addEventListener("click",(function(t){"none"!==n.style.display&&(e.contains(t.target)||n.contains(t.target)||(e.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)))}))}};for(n.s();!(t=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}})),formSubmit(document.getElementById("tour-form"),document.getElementById("tour-message"),"tour__message-open");var contactsForm=document.getElementById("contacts-form"),contactsFormOpen=document.getElementById("contacts-form-open"),contactsFormClose=document.getElementById("contacts-form-close"),headerBtnCallback=document.getElementById("callback");headerBtnCallback.addEventListener("click",(function(){return elemVisible(contactsForm,"contacts__form-open","flex")})),contactsFormOpen.addEventListener("click",(function(){return elemVisible(contactsForm,"contacts__form-open","flex")})),contactsFormClose.addEventListener("click",(function(){return elemHidden(contactsForm,"contacts__form-open","contacts__form-close",395)})),document.body.addEventListener("click",(function(e){"none"!==contactsForm.style.display&&(contactsForm.contains(e.target)||contactsFormOpen.contains(e.target)||headerBtnCallback.contains(e.target)||elemHidden(contactsForm,"contacts__form-open","contacts__form-close",395))})),formSubmit(contactsForm,document.getElementById("contacts-message"),"contacts__message-open");var AnchorLink=function(){function e(t){if(_classCallCheck(this,e),void 0===t.link||null===document.querySelector("".concat(t.link)))throw new Error("This link is not listed or does not exist!");if("HTMLAnchorElement"!==Object.getPrototypeOf(document.querySelector("".concat(t.link))).constructor.name)throw new Error("This selector is not a link!");if(void 0===t.topOffset)this.topOffset=100;else{if(isNaN(t.topOffset))throw new Error("Top offset must be a number!");if(t.topOffset<100)throw new Error("Top offset cannot be less than 100!");this.topOffset=t.topOffset}this.link=document.querySelectorAll("".concat(t.link))}return _createClass(e,[{key:"link",get:function(){return this._link},set:function(e){this._link=e,this.eventLink(this._link)}},{key:"retreatToAnchor",value:function(e){var t=e.getAttribute("href").substring(1);return document.getElementById("".concat(t)).getBoundingClientRect().top-this.topOffset}},{key:"eventLink",value:function(e){var t=this;e.forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),window.scrollBy({top:t.retreatToAnchor(e.target),behavior:"smooth"})}))}))}}]),e}();new AnchorLink({link:".header__nav-link",topOffset:200}),new AnchorLink({link:".header__nav-btn",topOffset:200});var ButtonSmoothScroll=function(){function e(t){if(_classCallCheck(this,e),void 0===t.btn||null===document.querySelector("".concat(t.btn)))throw new Error("This button is not listed or does not exist!");if("HTMLButtonElement"!==Object.getPrototypeOf(document.querySelector("".concat(t.btn))).constructor.name)throw new Error("This selector is not a button!");if(void 0===t.display&&(this.display="block"),"string"!=typeof t.display)throw new Error('"display" property is not a string!');if(this.display=t.display,void 0===t.pageYOffset)this.pageYOffset=100;else{if(isNaN(t.pageYOffset))throw new Error("Page Y offset must be a number!");if(t.pageYOffset<100)throw new Error("Page Y offset cannot be less than 100!");this.pageYOffset=t.pageYOffset}void 0!==t.class&&this.btn.classList.add("".concat(t.class)),void 0!==t.content&&(this.btn.innerHTML=t.content),this.btn=document.querySelector("".concat(t.btn))}return _createClass(e,[{key:"btn",get:function(){return this._btn},set:function(e){var t=this;this._btn=e,this._btn.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})})),window.addEventListener("load",(function(){return t.visibleOrHiddenBtn()})),window.addEventListener("scroll",(function(){return t.visibleOrHiddenBtn()}),{passive:!0})}},{key:"visibleOrHiddenBtn",value:function(){this.btn.style.position="fixed",window.pageYOffset>=this.pageYOffset?this.btn.style.display=this.display:this.btn.style.display="none"}}]),e}();function responseMessage(e,t,n){e.textContent=t,e.classList.add(n),setTimeout((function(){e.classList.remove(n)}),5e3)}function formSubmit(e,t,n){var o={};e.addEventListener("submit",(function(e){e.preventDefault();var r,i=_createForOfIteratorHelper(e.currentTarget.elements);try{for(i.s();!(r=i.n()).done;){var s=r.value;"INPUT"===s.nodeName&&(o[s.name]=s.value)}}catch(e){i.e(e)}finally{i.f()}fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",body:JSON.stringify(o),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){e.ok?responseMessage(t,"Ваши данные успешно отправлены, ожидайте дальнейшей связи с нами!",n):responseMessage(t,"Произошла ошибка при отправке данных, повторите данную операцию позже!",n)}))}))}new ButtonSmoothScroll({btn:"#btn-scroll",display:"flex",pageYOffset:200});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnQtaGlkZGVuLmpzIiwiaW5kZXguanMiLCJzY3JvbGwuanMiLCJzdWJtaXQtZnJvbS5qcyJdLCJuYW1lcyI6WyJlbGVtVmlzaWJsZSIsImVsIiwiY2xhc3NPcGVuIiwiZGlzcGxheSIsInN0eWxlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZWxlbUhpZGRlbiIsImNsYXNzQ2xvc2UiLCJtcyIsInVuZGVmaW5lZCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJ0b3VySW5wdXRWYWx1ZSIsIm1lbnUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibWVudU9wZW4iLCJtZW51Q2xvc2UiLCJoaWRkZW5NZW51IiwiYm9keSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ3aW5kb3ciLCJzY3JlZW4iLCJ3aWR0aCIsImNvbnRhaW5zIiwidGFyZ2V0IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpbnB1dCIsInRoaXMiLCJ2YWx1ZSIsInJlcGxhY2UiLCJpZCIsImxlbmd0aCIsIm1heExlbmd0aCIsInNsaWNlIiwiZHJvcGRvd25PcGVuIiwiZHJvcGRvd25DbG9zZSIsInNlbGVjdEFjdGl2ZSIsInNlbGVjdCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiLCJwYXJlbnRFbGVtZW50IiwiY2hpbGRyZW4iLCJfbG9vcCIsImVsZW0iLCJfc3RlcDIiLCJfaXRlcmF0b3IyIiwicyIsIm4iLCJkb25lIiwiZSIsIl9zdGVwMyIsIl9pdGVyYXRvcjMiLCJub2RlTmFtZSIsImN1cnJlbnRUYXJnZXQiLCJ0ZXh0Q29udGVudCIsImVyciIsImYiLCJmb3JtU3VibWl0IiwiY29udGFjdHNGb3JtIiwiY29udGFjdHNGb3JtT3BlbiIsImNvbnRhY3RzRm9ybUNsb3NlIiwiaGVhZGVyQnRuQ2FsbGJhY2siLCJBbmNob3JMaW5rIiwib3B0aW9ucyIsIl9jbGFzc0NhbGxDaGVjayIsImxpbmsiLCJxdWVyeVNlbGVjdG9yIiwiY29uY2F0IiwiRXJyb3IiLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsImNvbnN0cnVjdG9yIiwibmFtZSIsInRvcE9mZnNldCIsImlzTmFOIiwiX2xpbmsiLCJldmVudExpbmsiLCJocmVmIiwiZ2V0QXR0cmlidXRlIiwic3Vic3RyaW5nIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwiYXJyYXlsaW5rIiwiX3RoaXMiLCJwcmV2ZW50RGVmYXVsdCIsInNjcm9sbEJ5IiwicmV0cmVhdFRvQW5jaG9yIiwiYmVoYXZpb3IiLCJCdXR0b25TbW9vdGhTY3JvbGwiLCJidG4iLCJwYWdlWU9mZnNldCIsImNvbnRlbnQiLCJpbm5lckhUTUwiLCJfYnRuIiwiX3RoaXMyIiwic2Nyb2xsVG8iLCJ2aXNpYmxlT3JIaWRkZW5CdG4iLCJwYXNzaXZlIiwicG9zaXRpb24iLCJyZXNwb25zZU1lc3NhZ2UiLCJjbGFzc0FjdGl2ZSIsImZvcm0iLCJtZXNzYWdlQm94IiwiY2xhc3NBY3RpdmVNZXNzYWdlIiwiZGF0YSIsIl9zdGVwNCIsIl9pdGVyYXRvcjQiLCJlbGVtZW50cyIsImZldGNoIiwibWV0aG9kIiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJ0aGVuIiwicmVzIiwib2siXSwibWFwcGluZ3MiOiI2a0RBQ0EsU0FBQUEsWUFBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQUcsTUFBQUQsUUFBQUEsRUFDQUYsRUFBQUksVUFBQUMsSUFBQUosR0FHQSxTQUFBSyxXQUFBTixFQUFBQyxFQUFBTSxFQUFBQyxRQUNBQyxJQUFBUixHQUFBRCxFQUFBSSxVQUFBTSxPQUFBVCxHQUNBRCxFQUFBSSxVQUFBQyxJQUFBRSxHQUNBSSxZQUFBLFdBQ0FYLEVBQUFHLE1BQUFELFFBQUEsT0FDQUYsRUFBQUksVUFBQU0sT0FBQUgsS0FDQUMsR0NUQSxJQW9DQUksZUFwQ0FDLEtBQUFDLFNBQUFDLGVBQUEsUUFDQUMsU0FBQUYsU0FBQUMsZUFBQSxhQUNBRSxVQUFBSCxTQUFBQyxlQUFBLGNBU0EsU0FBQUcsYUFDQUosU0FB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RCxFQUFBNUQsTUFBQTJELEVBQUFDLEVBQUEzRCxLQUFBQyxNQUNBLENBQUEsSUFEQUwsRUFDQThELEVBQUE5RSxNQUFBLFVBQUFnQixFQUFBUyxXQUFBb0QsRUFBQTdELEVBQUE2QixNQUFBN0IsRUFBQWhCLFFBSkEsTUFBQTRCLEdBQUFtRCxFQUFBekQsRUFBQU0sR0FBQSxRQUFBbUQsRUFBQWxELElBTUFvRCxNQUFBLDZDQUFBLENBQ0FDLE9BQUEsT0FDQTdGLEtBQUE4RixLQUFBQyxVQUFBUCxHQUNBUSxRQUFBLENBQ0EsZUFBQSxxQ0FFQUMsTUFBQSxTQUFBQyxHQUNBQSxFQUFBQyxHQUNBaEIsZ0JBQ0FHLEVBQ0Esb0VBQ0FDLEdBR0FKLGdCQUNBRyxFQUNBLHlFQUNBQyxTRDJGQSxJQUFBZixtQkFBQSxDQUNBQyxJQUFBLGNBQ0ExRixRQUFBLE9BQ0EyRixZQUFBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbmZ1bmN0aW9uIGVsZW1WaXNpYmxlKGVsLCBjbGFzc09wZW4sIGRpc3BsYXkpIHtcbiAgZWwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7XG4gIGVsLmNsYXNzTGlzdC5hZGQoY2xhc3NPcGVuKTtcbn1cblxuZnVuY3Rpb24gZWxlbUhpZGRlbihlbCwgY2xhc3NPcGVuLCBjbGFzc0Nsb3NlLCBtcykge1xuICBpZiAoY2xhc3NPcGVuICE9PSB1bmRlZmluZWQpIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NPcGVuKTtcbiAgZWwuY2xhc3NMaXN0LmFkZChjbGFzc0Nsb3NlKTtcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzQ2xvc2UpO1xuICB9LCBtcyk7XG59XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xuXG4vLyBoZWFkZXJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudScpO1xuY29uc3QgbWVudU9wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS1vcGVuJyk7XG5jb25zdCBtZW51Q2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudS1jbG9zZScpO1xuXG5tZW51T3Blbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+XG4gIGVsZW1WaXNpYmxlKG1lbnUsICdoZWFkZXJfX25hdi1vcGVuJywgJ2ZsZXgnKVxuKTtcbm1lbnVDbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+XG4gIGVsZW1IaWRkZW4obWVudSwgJ2hlYWRlcl9fbmF2LW9wZW4nLCAnaGVhZGVyX19uYXYtY2xvc2UnLCAzOTUpXG4pO1xuXG5mdW5jdGlvbiBoaWRkZW5NZW51KCkge1xuICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGVsKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5zY3JlZW4ud2lkdGggPD0gODIwKSB7XG4gICAgICBpZiAobWVudS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHJldHVybjtcbiAgICAgIGlmICghbWVudS5jb250YWlucyhlbC50YXJnZXQpICYmICFtZW51T3Blbi5jb250YWlucyhlbC50YXJnZXQpKVxuICAgICAgICBlbGVtSGlkZGVuKG1lbnUsICdoZWFkZXJfX25hdi1vcGVuJywgJ2hlYWRlcl9fbmF2LWNsb3NlJywgMzk1KTtcbiAgICB9IGVsc2UgbWVudS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICB9KTtcbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiBoaWRkZW5NZW51KCkpO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IGhpZGRlbk1lbnUoKSk7XG5cbi8vIHRvdXJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyN0b3VyaXN0cywgI25pZ2h0cywgI2RhdGUnKS5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5yZXBsYWNlKFxuICAgICAgaW5wdXQuaWQgPT09ICdkYXRlJyA/IC9bXjAtOS5dL2cgOiAvW14wLTldL2csXG4gICAgICAnJ1xuICAgICk7XG4gICAgaWYgKHRoaXMudmFsdWUubGVuZ3RoID4gdGhpcy5tYXhMZW5ndGgpXG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZS5zbGljZSgwLCB0aGlzLm1heExlbmd0aCk7XG4gIH0pO1xufSk7XG5cbmxldCB0b3VySW5wdXRWYWx1ZTtcbmNvbnN0IGRyb3Bkb3duT3BlbiA9ICd0b3VyX19mb3JtLWRyb3Bkb3duLW9wZW4nO1xuY29uc3QgZHJvcGRvd25DbG9zZSA9ICd0b3VyX19mb3JtLWRyb3Bkb3duLWNsb3NlJztcbmNvbnN0IHNlbGVjdEFjdGl2ZSA9ICd0b3VyX19mb3JtLWRyb3Bkb3duLXNlbGVjdC1hY3RpdmUnO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG91cl9fZm9ybS1kcm9wZG93bi1zZWxlY3QnKS5mb3JFYWNoKChzZWxlY3QpID0+IHtcbiAgZm9yIChjb25zdCBlbGVtIG9mIHNlbGVjdC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuKVxuICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygndG91cl9fZm9ybS1kcm9wZG93bicpKSB7XG4gICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucyhzZWxlY3RBY3RpdmUpKSB7XG4gICAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdEFjdGl2ZSk7XG4gICAgICAgICAgZWxlbUhpZGRlbihlbGVtLCBkcm9wZG93bk9wZW4sIGRyb3Bkb3duQ2xvc2UsIDM5NSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKHNlbGVjdEFjdGl2ZSk7XG4gICAgICAgICAgZWxlbVZpc2libGUoZWxlbSwgZHJvcGRvd25PcGVuLCAnZmxleCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIGVsZW0uY2hpbGRyZW4pXG4gICAgICAgIG9wdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBpbnB1dCBvZiBzZWxlY3QuY2hpbGRyZW4pXG4gICAgICAgICAgICBpZiAoaW5wdXQubm9kZU5hbWUgPT09ICdJTlBVVCcpIHtcbiAgICAgICAgICAgICAgdG91cklucHV0VmFsdWUgPSBpbnB1dC52YWx1ZTtcbiAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBlLmN1cnJlbnRUYXJnZXQudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC50ZXh0Q29udGVudCA9IHRvdXJJbnB1dFZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgc2VsZWN0LmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0QWN0aXZlKTtcbiAgICAgICAgICBlbGVtSGlkZGVuKGVsZW0sIGRyb3Bkb3duT3BlbiwgZHJvcGRvd25DbG9zZSwgMzk1KTtcbiAgICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGVsKSA9PiB7XG4gICAgICAgIGlmIChlbGVtLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgcmV0dXJuO1xuICAgICAgICBpZiAoIXNlbGVjdC5jb250YWlucyhlbC50YXJnZXQpICYmICFlbGVtLmNvbnRhaW5zKGVsLnRhcmdldCkpIHtcbiAgICAgICAgICBzZWxlY3QuY2xhc3NMaXN0LnJlbW92ZShzZWxlY3RBY3RpdmUpO1xuICAgICAgICAgIGVsZW1IaWRkZW4oZWxlbSwgZHJvcGRvd25PcGVuLCBkcm9wZG93bkNsb3NlLCAzOTUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG59KTtcblxuZm9ybVN1Ym1pdChcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvdXItZm9ybScpLFxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG91ci1tZXNzYWdlJyksXG4gICd0b3VyX19tZXNzYWdlLW9wZW4nXG4pO1xuXG4vLyBjb250YWN0c1xuY29uc3QgY29udGFjdHNGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RzLWZvcm0nKTtcbmNvbnN0IGNvbnRhY3RzRm9ybU9wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFjdHMtZm9ybS1vcGVuJyk7XG5jb25zdCBjb250YWN0c0Zvcm1DbG9zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWN0cy1mb3JtLWNsb3NlJyk7XG5jb25zdCBoZWFkZXJCdG5DYWxsYmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWxsYmFjaycpO1xuXG5oZWFkZXJCdG5DYWxsYmFjay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+XG4gIGVsZW1WaXNpYmxlKGNvbnRhY3RzRm9ybSwgJ2NvbnRhY3RzX19mb3JtLW9wZW4nLCAnZmxleCcpXG4pO1xuY29udGFjdHNGb3JtT3Blbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+XG4gIGVsZW1WaXNpYmxlKGNvbnRhY3RzRm9ybSwgJ2NvbnRhY3RzX19mb3JtLW9wZW4nLCAnZmxleCcpXG4pO1xuY29udGFjdHNGb3JtQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PlxuICBlbGVtSGlkZGVuKGNvbnRhY3RzRm9ybSwgJ2NvbnRhY3RzX19mb3JtLW9wZW4nLCAnY29udGFjdHNfX2Zvcm0tY2xvc2UnLCAzOTUpXG4pO1xuZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlbCkgPT4ge1xuICBpZiAoY29udGFjdHNGb3JtLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgcmV0dXJuO1xuICBpZiAoXG4gICAgIWNvbnRhY3RzRm9ybS5jb250YWlucyhlbC50YXJnZXQpICYmXG4gICAgIWNvbnRhY3RzRm9ybU9wZW4uY29udGFpbnMoZWwudGFyZ2V0KSAmJlxuICAgICFoZWFkZXJCdG5DYWxsYmFjay5jb250YWlucyhlbC50YXJnZXQpXG4gIClcbiAgICBlbGVtSGlkZGVuKFxuICAgICAgY29udGFjdHNGb3JtLFxuICAgICAgJ2NvbnRhY3RzX19mb3JtLW9wZW4nLFxuICAgICAgJ2NvbnRhY3RzX19mb3JtLWNsb3NlJyxcbiAgICAgIDM5NVxuICAgICk7XG59KTtcblxuZm9ybVN1Ym1pdChcbiAgY29udGFjdHNGb3JtLFxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFjdHMtbWVzc2FnZScpLFxuICAnY29udGFjdHNfX21lc3NhZ2Utb3Blbidcbik7XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xuY2xhc3MgQW5jaG9yTGluayB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAvLyBhbmNob3JcbiAgICBpZiAoXG4gICAgICBvcHRpb25zLmxpbmsgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtvcHRpb25zLmxpbmt9YCkgPT09IG51bGxcbiAgICApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbGluayBpcyBub3QgbGlzdGVkIG9yIGRvZXMgbm90IGV4aXN0IScpO1xuICAgIGVsc2Uge1xuICAgICAgaWYgKFxuICAgICAgICBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtvcHRpb25zLmxpbmt9YCkpXG4gICAgICAgICAgLmNvbnN0cnVjdG9yLm5hbWUgIT09ICdIVE1MQW5jaG9yRWxlbWVudCdcbiAgICAgIClcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHNlbGVjdG9yIGlzIG5vdCBhIGxpbmshJyk7XG4gICAgICAvLyB0b3Agb2Zmc2V0XG4gICAgICBpZiAob3B0aW9ucy50b3BPZmZzZXQgPT09IHVuZGVmaW5lZCkgdGhpcy50b3BPZmZzZXQgPSAxMDA7XG4gICAgICBlbHNlIGlmIChpc05hTihvcHRpb25zLnRvcE9mZnNldCkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVG9wIG9mZnNldCBtdXN0IGJlIGEgbnVtYmVyIScpO1xuICAgICAgZWxzZSBpZiAob3B0aW9ucy50b3BPZmZzZXQgPCAxMDApXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVG9wIG9mZnNldCBjYW5ub3QgYmUgbGVzcyB0aGFuIDEwMCEnKTtcbiAgICAgIGVsc2UgdGhpcy50b3BPZmZzZXQgPSBvcHRpb25zLnRvcE9mZnNldDtcblxuICAgICAgdGhpcy5saW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgJHtvcHRpb25zLmxpbmt9YCk7XG4gICAgfVxuICB9XG5cbiAgc2V0IGxpbmsoZWwpIHtcbiAgICB0aGlzLl9saW5rID0gZWw7XG4gICAgdGhpcy5ldmVudExpbmsodGhpcy5fbGluayk7XG4gIH1cblxuICBnZXQgbGluaygpIHtcbiAgICByZXR1cm4gdGhpcy5fbGluaztcbiAgfVxuXG4gIHJldHJlYXRUb0FuY2hvcih0YXJnZXQpIHtcbiAgICBjb25zdCBocmVmID0gdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpLnN1YnN0cmluZygxKSxcbiAgICAgIHNjcm9sbFRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2hyZWZ9YCksXG4gICAgICBlbGVtZW50UG9zaXRpb24gPSBzY3JvbGxUYXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgIHJldHVybiBlbGVtZW50UG9zaXRpb24gLSB0aGlzLnRvcE9mZnNldDtcbiAgfVxuXG4gIGV2ZW50TGluayhhcnJheWxpbmspIHtcbiAgICBhcnJheWxpbmsuZm9yRWFjaCgobGluaykgPT4ge1xuICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgd2luZG93LnNjcm9sbEJ5KHtcbiAgICAgICAgICB0b3A6IHRoaXMucmV0cmVhdFRvQW5jaG9yKGUudGFyZ2V0KSxcbiAgICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCcsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxubmV3IEFuY2hvckxpbmsoe1xuICBsaW5rOiAnLmhlYWRlcl9fbmF2LWxpbmsnLFxuICB0b3BPZmZzZXQ6IDIwMCxcbn0pO1xuXG5uZXcgQW5jaG9yTGluayh7XG4gIGxpbms6ICcuaGVhZGVyX19uYXYtYnRuJyxcbiAgdG9wT2Zmc2V0OiAyMDAsXG59KTtcblxuY2xhc3MgQnV0dG9uU21vb3RoU2Nyb2xsIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIC8vIGJ1dHRvblxuICAgIGlmIChcbiAgICAgIG9wdGlvbnMuYnRuID09PSB1bmRlZmluZWQgfHxcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7b3B0aW9ucy5idG59YCkgPT09IG51bGxcbiAgICApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgYnV0dG9uIGlzIG5vdCBsaXN0ZWQgb3IgZG9lcyBub3QgZXhpc3QhJyk7XG4gICAgZWxzZSBpZiAoXG4gICAgICBPYmplY3QuZ2V0UHJvdG90eXBlT2YoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtvcHRpb25zLmJ0bn1gKSlcbiAgICAgICAgLmNvbnN0cnVjdG9yLm5hbWUgIT09ICdIVE1MQnV0dG9uRWxlbWVudCdcbiAgICApXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgc2VsZWN0b3IgaXMgbm90IGEgYnV0dG9uIScpO1xuICAgIGVsc2Uge1xuICAgICAgLy8gcHJvcGVydHkgXCJkaXNwbGF5XCJcbiAgICAgIGlmIChvcHRpb25zLmRpc3BsYXkgPT09IHVuZGVmaW5lZCkgdGhpcy5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kaXNwbGF5ICE9PSAnc3RyaW5nJylcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdcImRpc3BsYXlcIiBwcm9wZXJ0eSBpcyBub3QgYSBzdHJpbmchJyk7XG4gICAgICBlbHNlIHRoaXMuZGlzcGxheSA9IG9wdGlvbnMuZGlzcGxheTtcbiAgICAgIC8vIGluZGVudCBmcm9tIGFib3ZlXG4gICAgICBpZiAob3B0aW9ucy5wYWdlWU9mZnNldCA9PT0gdW5kZWZpbmVkKSB0aGlzLnBhZ2VZT2Zmc2V0ID0gMTAwO1xuICAgICAgZWxzZSBpZiAoaXNOYU4ob3B0aW9ucy5wYWdlWU9mZnNldCkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGFnZSBZIG9mZnNldCBtdXN0IGJlIGEgbnVtYmVyIScpO1xuICAgICAgZWxzZSBpZiAob3B0aW9ucy5wYWdlWU9mZnNldCA8IDEwMClcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYWdlIFkgb2Zmc2V0IGNhbm5vdCBiZSBsZXNzIHRoYW4gMTAwIScpO1xuICAgICAgZWxzZSB0aGlzLnBhZ2VZT2Zmc2V0ID0gb3B0aW9ucy5wYWdlWU9mZnNldDtcbiAgICAgIC8vIGFkZCBjbGFzcy1zdHlsZVxuICAgICAgaWYgKG9wdGlvbnMuY2xhc3MgIT09IHVuZGVmaW5lZClcbiAgICAgICAgdGhpcy5idG4uY2xhc3NMaXN0LmFkZChgJHtvcHRpb25zLmNsYXNzfWApO1xuICAgICAgLy8gYWRkIGNvbnRlbnRcbiAgICAgIGlmIChvcHRpb25zLmNvbnRlbnQgIT09IHVuZGVmaW5lZCkgdGhpcy5idG4uaW5uZXJIVE1MID0gb3B0aW9ucy5jb250ZW50O1xuXG4gICAgICB0aGlzLmJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7b3B0aW9ucy5idG59YCk7XG4gICAgfVxuICB9XG5cbiAgc2V0IGJ0bihlbGVtKSB7XG4gICAgdGhpcy5fYnRuID0gZWxlbTtcbiAgICB0aGlzLl9idG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oeyB0b3A6IDAsIGJlaGF2aW9yOiAnc21vb3RoJyB9KTtcbiAgICB9KTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHRoaXMudmlzaWJsZU9ySGlkZGVuQnRuKCkpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCAoKSA9PiB0aGlzLnZpc2libGVPckhpZGRlbkJ0bigpLCB7XG4gICAgICBwYXNzaXZlOiB0cnVlLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0IGJ0bigpIHtcbiAgICByZXR1cm4gdGhpcy5fYnRuO1xuICB9XG5cbiAgdmlzaWJsZU9ySGlkZGVuQnRuKCkge1xuICAgIHRoaXMuYnRuLnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcblxuICAgIGlmICh3aW5kb3cucGFnZVlPZmZzZXQgPj0gdGhpcy5wYWdlWU9mZnNldClcbiAgICAgIHRoaXMuYnRuLnN0eWxlLmRpc3BsYXkgPSB0aGlzLmRpc3BsYXk7XG4gICAgZWxzZSB0aGlzLmJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICB9XG59XG5cbm5ldyBCdXR0b25TbW9vdGhTY3JvbGwoe1xuICBidG46ICcjYnRuLXNjcm9sbCcsXG4gIGRpc3BsYXk6ICdmbGV4JyxcbiAgcGFnZVlPZmZzZXQ6IDIwMCxcbn0pO1xuIiwiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbmZ1bmN0aW9uIHJlc3BvbnNlTWVzc2FnZShlbGVtLCBjb250ZW50LCBjbGFzc0FjdGl2ZSkge1xuICBlbGVtLnRleHRDb250ZW50ID0gY29udGVudDtcbiAgZWxlbS5jbGFzc0xpc3QuYWRkKGNsYXNzQWN0aXZlKTtcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzQWN0aXZlKTtcbiAgfSwgNTAwMCk7XG59XG5cbmZ1bmN0aW9uIGZvcm1TdWJtaXQoZm9ybSwgbWVzc2FnZUJveCwgY2xhc3NBY3RpdmVNZXNzYWdlKSB7XG4gIGxldCBkYXRhID0ge307XG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIGZvciAobGV0IGVsZW0gb2YgZS5jdXJyZW50VGFyZ2V0LmVsZW1lbnRzKVxuICAgICAgaWYgKGVsZW0ubm9kZU5hbWUgPT09ICdJTlBVVCcpIGRhdGFbZWxlbS5uYW1lXSA9IGVsZW0udmFsdWU7XG5cbiAgICBmZXRjaCgnaHR0cHM6Ly9qc29ucGxhY2Vob2xkZXIudHlwaWNvZGUuY29tL3Bvc3RzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04JyxcbiAgICAgIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKVxuICAgICAgICByZXNwb25zZU1lc3NhZ2UoXG4gICAgICAgICAgbWVzc2FnZUJveCxcbiAgICAgICAgICAn0JLQsNGI0Lgg0LTQsNC90L3Ri9C1INGD0YHQv9C10YjQvdC+INC+0YLQv9GA0LDQstC70LXQvdGLLCDQvtC20LjQtNCw0LnRgtC1INC00LDQu9GM0L3QtdC50YjQtdC5INGB0LLRj9C30Lgg0YEg0L3QsNC80LghJyxcbiAgICAgICAgICBjbGFzc0FjdGl2ZU1lc3NhZ2VcbiAgICAgICAgKTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmVzcG9uc2VNZXNzYWdlKFxuICAgICAgICAgIG1lc3NhZ2VCb3gsXG4gICAgICAgICAgJ9Cf0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LAg0L/RgNC4INC+0YLQv9GA0LDQstC60LUg0LTQsNC90L3Ri9GFLCDQv9C+0LLRgtC+0YDQuNGC0LUg0LTQsNC90L3Rg9GOINC+0L/QtdGA0LDRhtC40Y4g0L/QvtC30LbQtSEnLFxuICAgICAgICAgIGNsYXNzQWN0aXZlTWVzc2FnZVxuICAgICAgICApO1xuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==
