"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function elemVisible(e,t,n){e.style.display=n,e.classList.add(t)}function elemHidden(e,t,n,o){void 0!==t&&e.classList.remove(t),e.classList.add(n),setTimeout((function(){e.style.display="none",e.classList.remove(n)}),o)}var tourInputValue,menu=document.getElementById("menu"),menuOpen=document.getElementById("menu-open"),menuClose=document.getElementById("menu-close");function hiddenMenu(){document.querySelectorAll(".header__nav-link, .header__nav-account").forEach((function(e){window.screen.width<=820&&e.addEventListener("click",(function(){return elemHidden(menu,"header__nav-open","header__nav-close",395)}))})),document.body.addEventListener("click",(function(e){if(window.screen.width<=820){if("none"===menu.style.display)return;menu.contains(e.target)||menuOpen.contains(e.target)||elemHidden(menu,"header__nav-open","header__nav-close",395)}else menu.style.display="flex"}))}menuOpen.addEventListener("click",(function(){return elemVisible(menu,"header__nav-open","flex")})),menuClose.addEventListener("click",(function(){return elemHidden(menu,"header__nav-open","header__nav-close",395)})),window.addEventListener("load",(function(){return hiddenMenu()})),window.addEventListener("resize",(function(){return hiddenMenu()})),document.querySelectorAll("#tourists, #nights, #date").forEach((function(e){e.addEventListener("input",(function(){this.value=this.value.replace("date"===e.id?/[^0-9.]/g:/[^0-9]/g,""),this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength))}))}));var dropdownOpen="tour__form-dropdown-open",dropdownClose="tour__form-dropdown-close",selectActive="tour__form-dropdown-select-active";document.querySelectorAll(".tour__form-dropdown-select").forEach((function(e){var t,n=_createForOfIteratorHelper(e.parentElement.children);try{var o=function(){var n=t.value;if(n.classList.contains("tour__form-dropdown")){e.addEventListener("click",(function(){this.classList.contains(selectActive)?(this.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)):(this.classList.add(selectActive),elemVisible(n,dropdownOpen,"flex"))}));var o,r=_createForOfIteratorHelper(n.children);try{for(r.s();!(o=r.n()).done;){o.value.addEventListener("click",(function(t){var o,r=_createForOfIteratorHelper(e.children);try{for(r.s();!(o=r.n()).done;){var i=o.value;"INPUT"===i.nodeName&&(tourInputValue=i.value,i.value=t.currentTarget.textContent,t.currentTarget.textContent=tourInputValue)}}catch(e){r.e(e)}finally{r.f()}e.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)}))}}catch(e){r.e(e)}finally{r.f()}document.body.addEventListener("click",(function(t){"none"!==n.style.display&&(e.contains(t.target)||n.contains(t.target)||(e.classList.remove(selectActive),elemHidden(n,dropdownOpen,dropdownClose,395)))}))}};for(n.s();!(t=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}})),formSubmit(document.getElementById("tour-form"),document.getElementById("tour-message"),"tour__message-open");var contactsForm=document.getElementById("contacts-form"),contactsFormOpen=document.getElementById("contacts-form-open"),contactsFormClose=document.getElementById("contacts-form-close"),headerBtnCallback=document.getElementById("callback");headerBtnCallback.addEventListener("click",(function(){return elemVisible(contactsForm,"contacts__form-open","flex")})),contactsFormOpen.addEventListener("click",(function(){return elemVisible(contactsForm,"contacts__form-open","flex")})),contactsFormClose.addEventListener("click",(function(){return elemHidden(contactsForm,"contacts__form-open","contacts__form-close",395)})),document.body.addEventListener("click",(function(e){"none"!==contactsForm.style.display&&(contactsForm.contains(e.target)||contactsFormOpen.contains(e.target)||headerBtnCallback.contains(e.target)||elemHidden(contactsForm,"contacts__form-open","contacts__form-close",395))})),formSubmit(contactsForm,document.getElementById("contacts-message"),"contacts__message-open");var AnchorLink=function(){function e(t){if(_classCallCheck(this,e),void 0===t.link||null===document.querySelector("".concat(t.link)))throw new Error("This link is not listed or does not exist!");if("HTMLAnchorElement"!==Object.getPrototypeOf(document.querySelector("".concat(t.link))).constructor.name)throw new Error("This selector is not a link!");if(void 0===t.topOffset)this.topOffset=100;else{if(isNaN(t.topOffset))throw new Error("Top offset must be a number!");if(t.topOffset<100)throw new Error("Top offset cannot be less than 100!");this.topOffset=t.topOffset}this.link=document.querySelectorAll("".concat(t.link))}return _createClass(e,[{key:"link",get:function(){return this._link},set:function(e){this._link=e,this.eventLink(this._link)}},{key:"retreatToAnchor",value:function(e){var t=e.getAttribute("href").substring(1);return document.getElementById("".concat(t)).getBoundingClientRect().top-this.topOffset}},{key:"eventLink",value:function(e){var t=this;e.forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),window.scrollBy({top:t.retreatToAnchor(e.target),behavior:"smooth"})}))}))}}]),e}();new AnchorLink({link:".header__nav-link",topOffset:200}),new AnchorLink({link:".header__nav-btn",topOffset:200});var ButtonSmoothScroll=function(){function e(t){if(_classCallCheck(this,e),void 0===t.btn||null===document.querySelector("".concat(t.btn)))throw new Error("This button is not listed or does not exist!");if("HTMLButtonElement"!==Object.getPrototypeOf(document.querySelector("".concat(t.btn))).constructor.name)throw new Error("This selector is not a button!");if(void 0===t.display&&(this.display="block"),"string"!=typeof t.display)throw new Error('"display" property is not a string!');if(this.display=t.display,void 0===t.pageYOffset)this.pageYOffset=100;else{if(isNaN(t.pageYOffset))throw new Error("Page Y offset must be a number!");if(t.pageYOffset<100)throw new Error("Page Y offset cannot be less than 100!");this.pageYOffset=t.pageYOffset}void 0!==t.class&&this.btn.classList.add("".concat(t.class)),void 0!==t.content&&(this.btn.innerHTML=t.content),this.btn=document.querySelector("".concat(t.btn))}return _createClass(e,[{key:"btn",get:function(){return this._btn},set:function(e){var t=this;this._btn=e,this._btn.addEventListener("click",(function(){window.scrollTo({top:0,behavior:"smooth"})})),window.addEventListener("load",(function(){return t.visibleOrHiddenBtn()})),window.addEventListener("scroll",(function(){return t.visibleOrHiddenBtn()}),{passive:!0})}},{key:"visibleOrHiddenBtn",value:function(){this.btn.style.position="fixed",window.pageYOffset>=this.pageYOffset?this.btn.style.display=this.display:this.btn.style.display="none"}}]),e}();function responseMessage(e,t,n){e.textContent=t,e.classList.add(n),setTimeout((function(){e.classList.remove(n)}),5e3)}function formSubmit(e,t,n){var o={};e.addEventListener("submit",(function(e){e.preventDefault();var r,i=_createForOfIteratorHelper(e.currentTarget.elements);try{for(i.s();!(r=i.n()).done;){var s=r.value;"INPUT"===s.nodeName&&(o[s.name]=s.value)}}catch(e){i.e(e)}finally{i.f()}fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",body:JSON.stringify(o),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((function(e){e.ok?responseMessage(t,"Ваши данные успешно отправлены, ожидайте дальнейшей связи с нами!",n):responseMessage(t,"Произошла ошибка при отправке данных, повторите данную операцию позже!",n)}))}))}new ButtonSmoothScroll({btn:"#btn-scroll",display:"flex",pageYOffset:200});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnQtaGlkZGVuLmpzIiwiaW5kZXguanMiLCJzY3JvbGwuanMiLCJzdWJtaXQtZnJvbS5qcyJdLCJuYW1lcyI6WyJlbGVtVmlzaWJsZSIsImVsIiwiY2xhc3NPcGVuIiwiZGlzcGxheSIsInN0eWxlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZWxlbUhpZGRlbiIsImNsYXNzQ2xvc2UiLCJtcyIsInVuZGVmaW5lZCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJ0b3VySW5wdXRWYWx1ZSIsIm1lbnUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibWVudU9wZW4iLCJtZW51Q2xvc2UiLCJoaWRkZW5NZW51IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJidG4iLCJ3aW5kb3ciLCJzY3JlZW4iLCJ3aWR0aCIsImFkZEV2ZW50TGlzdGVuZXIiLCJib2R5IiwiY29udGFpbnMiLCJ0YXJnZXQiLCJpbnB1dCIsInRoaXMiLCJ2YWx1ZSIsInJlcGxhY2UiLCJpZCIsImxlbmd0aCIsIm1heExlbmd0aCIsInNsaWNlIiwiZHJvcGRvd25PcGVuIiwiZHJvcGRvd25DbG9zZSIsInNlbGVjdEFjdGl2ZSIsInNlbGVjdCIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiLCJwYXJlbnRFbGVtZW50IiwiY2hpbGRyZW4iLCJfbG9vcCIsImVsZW0iLCJfc3RlcDIiLCJfaXRlcmF0b3IyIiwicyIsIm4iLCJkb25lIiwiZSIsIl9zdGVwMyIsIl9pdGVyYXRvcjMiLCJub2RlTmFtZSIsImN1cnJlbnRUYXJnZXQiLCJ0ZXh0Q29udGVudCIsImVyciIsImYiLCJmb3JtU3VibWl0IiwiY29udGFjdHNGb3JtIiwiY29udGFjdHNGb3JtT3BlbiIsImNvbnRhY3RzRm9ybUNsb3NlIiwiaGVhZGVyQnRuQ2FsbGJhY2siLCJBbmNob3JMaW5rIiwib3B0aW9ucyIsIl9jbGFzc0NhbGxDaGVjayIsImxpbmsiLCJxdWVyeVNlbGVjdG9yIiwiY29uY2F0IiwiRXJyb3IiLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsImNvbnN0cnVjdG9yIiwibmFtZSIsInRvcE9mZnNldCIsImlzTmFOIiwiX2xpbmsiLCJldmVudExpbmsiLCJocmVmIiwiZ2V0QXR0cmlidXRlIiwic3Vic3RyaW5nIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwiYXJyYXlsaW5rIiwiX3RoaXMiLCJwcmV2ZW50RGVmYXVsdCIsInNjcm9sbEJ5IiwicmV0cmVhdFRvQW5jaG9yIiwiYmVoYXZpb3IiLCJCdXR0b25TbW9vdGhTY3JvbGwiLCJwYWdlWU9mZnNldCIsImNvbnRlbnQiLCJpbm5lckhUTUwiLCJfYnRuIiwiX3RoaXMyIiwic2Nyb2xsVG8iLCJ2aXNpYmxlT3JIaWRkZW5CdG4iLCJwYXNzaXZlIiwicG9zaXRpb24iLCJyZXNwb25zZU1lc3NhZ2UiLCJjbGFzc0FjdGl2ZSIsImZvcm0iLCJtZXNzYWdlQm94IiwiY2xhc3NBY3RpdmVNZXNzYWdlIiwiZGF0YSIsIl9zdGVwNCIsIl9pdGVyYXRvcjQiLCJlbGVtZW50cyIsImZldGNoIiwibWV0aG9kIiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJ0aGVuIiwicmVzIiwib2siXSwibWFwcGluZ3MiOiI2a0RBQ0EsU0FBQUEsWUFBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQUcsTUFBQUQsUUFBQUEsRUFDQUYsRUFBQUksVUFBQUMsSUFBQUosR0FHQSxTQUFBSyxXQUFBTixFQUFBQyxFQUFBTSxFQUFBQyxRQUNBQyxJQUFBUixHQUFBRCxFQUFBSSxVQUFBTSxPQUFBVCxHQUNBRCxFQUFBSSxVQUFBQyxJQUFBRSxHQUNBSSxZQUFBLFdBQ0FYLEVBQUFHLE1BQUFELFFBQUEsT0FDQUYsRUFBQUksVUFBQU0sT0FBQUgsS0FDQUMsR0NUQSxJQTZDQUksZUE3Q0FDLEtBQUFDLFNBQUFDLGVBQUEsUUFDQUMsU0FBQUYsU0FBQUMsZUFBQSxhQUNBRSxVQUFBSCxTQUFBQyxlQUFBLGNBU0EsU0FBQUcsYUFDQUosU0FD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QUMsRUFBQSxHQUVBSCxFQUFBL0UsaUJBQUEsVUFBQSxTQUFBNEIsR0FDQUEsRUFBQW1DLGlCQURBLElBQUFvQixFQUFBQyxFQUFBbEUsMkJBR0FVLEVBQUFJLGNBQUFxRCxVQUhBLElBR0EsSUFBQUQsRUFBQTNELE1BQUEwRCxFQUFBQyxFQUFBMUQsS0FBQUMsTUFDQSxDQUFBLElBREFMLEVBQ0E2RCxFQUFBN0UsTUFBQSxVQUFBZ0IsRUFBQVMsV0FBQW1ELEVBQUE1RCxFQUFBNkIsTUFBQTdCLEVBQUFoQixRQUpBLE1BQUE0QixHQUFBa0QsRUFBQXhELEVBQUFNLEdBQUEsUUFBQWtELEVBQUFqRCxJQU1BbUQsTUFBQSw2Q0FBQSxDQUNBQyxPQUFBLE9BQ0F0RixLQUFBdUYsS0FBQUMsVUFBQVAsR0FDQVEsUUFBQSxDQUNBLGVBQUEscUNBRUFDLE1BQUEsU0FBQUMsR0FDQUEsRUFBQUMsR0FDQWhCLGdCQUNBRyxFQUNBLG9FQUNBQyxHQUdBSixnQkFDQUcsRUFDQSx5RUFDQUMsU0QyRkEsSUFBQWQsbUJBQUEsQ0FDQXZFLElBQUEsY0FDQW5CLFFBQUEsT0FDQTJGLFlBQUEiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqL1xuZnVuY3Rpb24gZWxlbVZpc2libGUoZWwsIGNsYXNzT3BlbiwgZGlzcGxheSkge1xuICBlbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheTtcbiAgZWwuY2xhc3NMaXN0LmFkZChjbGFzc09wZW4pO1xufVxuXG5mdW5jdGlvbiBlbGVtSGlkZGVuKGVsLCBjbGFzc09wZW4sIGNsYXNzQ2xvc2UsIG1zKSB7XG4gIGlmIChjbGFzc09wZW4gIT09IHVuZGVmaW5lZCkgZWwuY2xhc3NMaXN0LnJlbW92ZShjbGFzc09wZW4pO1xuICBlbC5jbGFzc0xpc3QuYWRkKGNsYXNzQ2xvc2UpO1xuICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NDbG9zZSk7XG4gIH0sIG1zKTtcbn1cbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovXG5cbi8vIGhlYWRlclxuY29uc3QgbWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51Jyk7XG5jb25zdCBtZW51T3BlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LW9wZW4nKTtcbmNvbnN0IG1lbnVDbG9zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZW51LWNsb3NlJyk7XG5cbm1lbnVPcGVuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT5cbiAgZWxlbVZpc2libGUobWVudSwgJ2hlYWRlcl9fbmF2LW9wZW4nLCAnZmxleCcpXG4pO1xubWVudUNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT5cbiAgZWxlbUhpZGRlbihtZW51LCAnaGVhZGVyX19uYXYtb3BlbicsICdoZWFkZXJfX25hdi1jbG9zZScsIDM5NSlcbik7XG5cbmZ1bmN0aW9uIGhpZGRlbk1lbnUoKSB7XG4gIGRvY3VtZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJy5oZWFkZXJfX25hdi1saW5rLCAuaGVhZGVyX19uYXYtYWNjb3VudCcpXG4gICAgLmZvckVhY2goKGJ0bikgPT4ge1xuICAgICAgaWYgKHdpbmRvdy5zY3JlZW4ud2lkdGggPD0gODIwKSB7XG4gICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+XG4gICAgICAgICAgZWxlbUhpZGRlbihtZW51LCAnaGVhZGVyX19uYXYtb3BlbicsICdoZWFkZXJfX25hdi1jbG9zZScsIDM5NSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlbCkgPT4ge1xuICAgIGlmICh3aW5kb3cuc2NyZWVuLndpZHRoIDw9IDgyMCkge1xuICAgICAgaWYgKG1lbnUuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSByZXR1cm47XG4gICAgICBpZiAoIW1lbnUuY29udGFpbnMoZWwudGFyZ2V0KSAmJiAhbWVudU9wZW4uY29udGFpbnMoZWwudGFyZ2V0KSlcbiAgICAgICAgZWxlbUhpZGRlbihtZW51LCAnaGVhZGVyX19uYXYtb3BlbicsICdoZWFkZXJfX25hdi1jbG9zZScsIDM5NSk7XG4gICAgfSBlbHNlIG1lbnUuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgfSk7XG59XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gaGlkZGVuTWVudSgpKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiBoaWRkZW5NZW51KCkpO1xuXG4vLyB0b3VyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjdG91cmlzdHMsICNuaWdodHMsICNkYXRlJykuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUucmVwbGFjZShcbiAgICAgIGlucHV0LmlkID09PSAnZGF0ZScgPyAvW14wLTkuXS9nIDogL1teMC05XS9nLFxuICAgICAgJydcbiAgICApO1xuICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA+IHRoaXMubWF4TGVuZ3RoKVxuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUuc2xpY2UoMCwgdGhpcy5tYXhMZW5ndGgpO1xuICB9KTtcbn0pO1xuXG5sZXQgdG91cklucHV0VmFsdWU7XG5jb25zdCBkcm9wZG93bk9wZW4gPSAndG91cl9fZm9ybS1kcm9wZG93bi1vcGVuJztcbmNvbnN0IGRyb3Bkb3duQ2xvc2UgPSAndG91cl9fZm9ybS1kcm9wZG93bi1jbG9zZSc7XG5jb25zdCBzZWxlY3RBY3RpdmUgPSAndG91cl9fZm9ybS1kcm9wZG93bi1zZWxlY3QtYWN0aXZlJztcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRvdXJfX2Zvcm0tZHJvcGRvd24tc2VsZWN0JykuZm9yRWFjaCgoc2VsZWN0KSA9PiB7XG4gIGZvciAoY29uc3QgZWxlbSBvZiBzZWxlY3QucGFyZW50RWxlbWVudC5jaGlsZHJlbilcbiAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoJ3RvdXJfX2Zvcm0tZHJvcGRvd24nKSkge1xuICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoc2VsZWN0QWN0aXZlKSkge1xuICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZShzZWxlY3RBY3RpdmUpO1xuICAgICAgICAgIGVsZW1IaWRkZW4oZWxlbSwgZHJvcGRvd25PcGVuLCBkcm9wZG93bkNsb3NlLCAzOTUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChzZWxlY3RBY3RpdmUpO1xuICAgICAgICAgIGVsZW1WaXNpYmxlKGVsZW0sIGRyb3Bkb3duT3BlbiwgJ2ZsZXgnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBmb3IgKGNvbnN0IG9wdGlvbiBvZiBlbGVtLmNoaWxkcmVuKVxuICAgICAgICBvcHRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgIGZvciAoY29uc3QgaW5wdXQgb2Ygc2VsZWN0LmNoaWxkcmVuKVxuICAgICAgICAgICAgaWYgKGlucHV0Lm5vZGVOYW1lID09PSAnSU5QVVQnKSB7XG4gICAgICAgICAgICAgIHRvdXJJbnB1dFZhbHVlID0gaW5wdXQudmFsdWU7XG4gICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gZS5jdXJyZW50VGFyZ2V0LnRleHRDb250ZW50O1xuICAgICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQudGV4dENvbnRlbnQgPSB0b3VySW5wdXRWYWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIHNlbGVjdC5jbGFzc0xpc3QucmVtb3ZlKHNlbGVjdEFjdGl2ZSk7XG4gICAgICAgICAgZWxlbUhpZGRlbihlbGVtLCBkcm9wZG93bk9wZW4sIGRyb3Bkb3duQ2xvc2UsIDM5NSk7XG4gICAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlbCkgPT4ge1xuICAgICAgICBpZiAoZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHJldHVybjtcbiAgICAgICAgaWYgKCFzZWxlY3QuY29udGFpbnMoZWwudGFyZ2V0KSAmJiAhZWxlbS5jb250YWlucyhlbC50YXJnZXQpKSB7XG4gICAgICAgICAgc2VsZWN0LmNsYXNzTGlzdC5yZW1vdmUoc2VsZWN0QWN0aXZlKTtcbiAgICAgICAgICBlbGVtSGlkZGVuKGVsZW0sIGRyb3Bkb3duT3BlbiwgZHJvcGRvd25DbG9zZSwgMzk1KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxufSk7XG5cbmZvcm1TdWJtaXQoXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3VyLWZvcm0nKSxcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvdXItbWVzc2FnZScpLFxuICAndG91cl9fbWVzc2FnZS1vcGVuJ1xuKTtcblxuLy8gY29udGFjdHNcbmNvbnN0IGNvbnRhY3RzRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWN0cy1mb3JtJyk7XG5jb25zdCBjb250YWN0c0Zvcm1PcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RzLWZvcm0tb3BlbicpO1xuY29uc3QgY29udGFjdHNGb3JtQ2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFjdHMtZm9ybS1jbG9zZScpO1xuY29uc3QgaGVhZGVyQnRuQ2FsbGJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsbGJhY2snKTtcblxuaGVhZGVyQnRuQ2FsbGJhY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PlxuICBlbGVtVmlzaWJsZShjb250YWN0c0Zvcm0sICdjb250YWN0c19fZm9ybS1vcGVuJywgJ2ZsZXgnKVxuKTtcbmNvbnRhY3RzRm9ybU9wZW4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PlxuICBlbGVtVmlzaWJsZShjb250YWN0c0Zvcm0sICdjb250YWN0c19fZm9ybS1vcGVuJywgJ2ZsZXgnKVxuKTtcbmNvbnRhY3RzRm9ybUNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT5cbiAgZWxlbUhpZGRlbihjb250YWN0c0Zvcm0sICdjb250YWN0c19fZm9ybS1vcGVuJywgJ2NvbnRhY3RzX19mb3JtLWNsb3NlJywgMzk1KVxuKTtcbmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZWwpID0+IHtcbiAgaWYgKGNvbnRhY3RzRm9ybS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHJldHVybjtcbiAgaWYgKFxuICAgICFjb250YWN0c0Zvcm0uY29udGFpbnMoZWwudGFyZ2V0KSAmJlxuICAgICFjb250YWN0c0Zvcm1PcGVuLmNvbnRhaW5zKGVsLnRhcmdldCkgJiZcbiAgICAhaGVhZGVyQnRuQ2FsbGJhY2suY29udGFpbnMoZWwudGFyZ2V0KVxuICApXG4gICAgZWxlbUhpZGRlbihcbiAgICAgIGNvbnRhY3RzRm9ybSxcbiAgICAgICdjb250YWN0c19fZm9ybS1vcGVuJyxcbiAgICAgICdjb250YWN0c19fZm9ybS1jbG9zZScsXG4gICAgICAzOTVcbiAgICApO1xufSk7XG5cbmZvcm1TdWJtaXQoXG4gIGNvbnRhY3RzRm9ybSxcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RzLW1lc3NhZ2UnKSxcbiAgJ2NvbnRhY3RzX19tZXNzYWdlLW9wZW4nXG4pO1xuIiwiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi9cbmNsYXNzIEFuY2hvckxpbmsge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgLy8gYW5jaG9yXG4gICAgaWYgKFxuICAgICAgb3B0aW9ucy5saW5rID09PSB1bmRlZmluZWQgfHxcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7b3B0aW9ucy5saW5rfWApID09PSBudWxsXG4gICAgKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGxpbmsgaXMgbm90IGxpc3RlZCBvciBkb2VzIG5vdCBleGlzdCEnKTtcbiAgICBlbHNlIHtcbiAgICAgIGlmIChcbiAgICAgICAgT2JqZWN0LmdldFByb3RvdHlwZU9mKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7b3B0aW9ucy5saW5rfWApKVxuICAgICAgICAgIC5jb25zdHJ1Y3Rvci5uYW1lICE9PSAnSFRNTEFuY2hvckVsZW1lbnQnXG4gICAgICApXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBzZWxlY3RvciBpcyBub3QgYSBsaW5rIScpO1xuICAgICAgLy8gdG9wIG9mZnNldFxuICAgICAgaWYgKG9wdGlvbnMudG9wT2Zmc2V0ID09PSB1bmRlZmluZWQpIHRoaXMudG9wT2Zmc2V0ID0gMTAwO1xuICAgICAgZWxzZSBpZiAoaXNOYU4ob3B0aW9ucy50b3BPZmZzZXQpKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RvcCBvZmZzZXQgbXVzdCBiZSBhIG51bWJlciEnKTtcbiAgICAgIGVsc2UgaWYgKG9wdGlvbnMudG9wT2Zmc2V0IDwgMTAwKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RvcCBvZmZzZXQgY2Fubm90IGJlIGxlc3MgdGhhbiAxMDAhJyk7XG4gICAgICBlbHNlIHRoaXMudG9wT2Zmc2V0ID0gb3B0aW9ucy50b3BPZmZzZXQ7XG5cbiAgICAgIHRoaXMubGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYCR7b3B0aW9ucy5saW5rfWApO1xuICAgIH1cbiAgfVxuXG4gIHNldCBsaW5rKGVsKSB7XG4gICAgdGhpcy5fbGluayA9IGVsO1xuICAgIHRoaXMuZXZlbnRMaW5rKHRoaXMuX2xpbmspO1xuICB9XG5cbiAgZ2V0IGxpbmsoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpbms7XG4gIH1cblxuICByZXRyZWF0VG9BbmNob3IodGFyZ2V0KSB7XG4gICAgY29uc3QgaHJlZiA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKS5zdWJzdHJpbmcoMSksXG4gICAgICBzY3JvbGxUYXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtocmVmfWApLFxuICAgICAgZWxlbWVudFBvc2l0aW9uID0gc2Nyb2xsVGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICByZXR1cm4gZWxlbWVudFBvc2l0aW9uIC0gdGhpcy50b3BPZmZzZXQ7XG4gIH1cblxuICBldmVudExpbmsoYXJyYXlsaW5rKSB7XG4gICAgYXJyYXlsaW5rLmZvckVhY2goKGxpbmspID0+IHtcbiAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxCeSh7XG4gICAgICAgICAgdG9wOiB0aGlzLnJldHJlYXRUb0FuY2hvcihlLnRhcmdldCksXG4gICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbm5ldyBBbmNob3JMaW5rKHtcbiAgbGluazogJy5oZWFkZXJfX25hdi1saW5rJyxcbiAgdG9wT2Zmc2V0OiAyMDAsXG59KTtcblxubmV3IEFuY2hvckxpbmsoe1xuICBsaW5rOiAnLmhlYWRlcl9fbmF2LWJ0bicsXG4gIHRvcE9mZnNldDogMjAwLFxufSk7XG5cbmNsYXNzIEJ1dHRvblNtb290aFNjcm9sbCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAvLyBidXR0b25cbiAgICBpZiAoXG4gICAgICBvcHRpb25zLmJ0biA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke29wdGlvbnMuYnRufWApID09PSBudWxsXG4gICAgKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGJ1dHRvbiBpcyBub3QgbGlzdGVkIG9yIGRvZXMgbm90IGV4aXN0IScpO1xuICAgIGVsc2UgaWYgKFxuICAgICAgT2JqZWN0LmdldFByb3RvdHlwZU9mKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7b3B0aW9ucy5idG59YCkpXG4gICAgICAgIC5jb25zdHJ1Y3Rvci5uYW1lICE9PSAnSFRNTEJ1dHRvbkVsZW1lbnQnXG4gICAgKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIHNlbGVjdG9yIGlzIG5vdCBhIGJ1dHRvbiEnKTtcbiAgICBlbHNlIHtcbiAgICAgIC8vIHByb3BlcnR5IFwiZGlzcGxheVwiXG4gICAgICBpZiAob3B0aW9ucy5kaXNwbGF5ID09PSB1bmRlZmluZWQpIHRoaXMuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZGlzcGxheSAhPT0gJ3N0cmluZycpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignXCJkaXNwbGF5XCIgcHJvcGVydHkgaXMgbm90IGEgc3RyaW5nIScpO1xuICAgICAgZWxzZSB0aGlzLmRpc3BsYXkgPSBvcHRpb25zLmRpc3BsYXk7XG4gICAgICAvLyBpbmRlbnQgZnJvbSBhYm92ZVxuICAgICAgaWYgKG9wdGlvbnMucGFnZVlPZmZzZXQgPT09IHVuZGVmaW5lZCkgdGhpcy5wYWdlWU9mZnNldCA9IDEwMDtcbiAgICAgIGVsc2UgaWYgKGlzTmFOKG9wdGlvbnMucGFnZVlPZmZzZXQpKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhZ2UgWSBvZmZzZXQgbXVzdCBiZSBhIG51bWJlciEnKTtcbiAgICAgIGVsc2UgaWYgKG9wdGlvbnMucGFnZVlPZmZzZXQgPCAxMDApXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGFnZSBZIG9mZnNldCBjYW5ub3QgYmUgbGVzcyB0aGFuIDEwMCEnKTtcbiAgICAgIGVsc2UgdGhpcy5wYWdlWU9mZnNldCA9IG9wdGlvbnMucGFnZVlPZmZzZXQ7XG4gICAgICAvLyBhZGQgY2xhc3Mtc3R5bGVcbiAgICAgIGlmIChvcHRpb25zLmNsYXNzICE9PSB1bmRlZmluZWQpXG4gICAgICAgIHRoaXMuYnRuLmNsYXNzTGlzdC5hZGQoYCR7b3B0aW9ucy5jbGFzc31gKTtcbiAgICAgIC8vIGFkZCBjb250ZW50XG4gICAgICBpZiAob3B0aW9ucy5jb250ZW50ICE9PSB1bmRlZmluZWQpIHRoaXMuYnRuLmlubmVySFRNTCA9IG9wdGlvbnMuY29udGVudDtcblxuICAgICAgdGhpcy5idG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke29wdGlvbnMuYnRufWApO1xuICAgIH1cbiAgfVxuXG4gIHNldCBidG4oZWxlbSkge1xuICAgIHRoaXMuX2J0biA9IGVsZW07XG4gICAgdGhpcy5fYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7XG4gICAgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB0aGlzLnZpc2libGVPckhpZGRlbkJ0bigpKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4gdGhpcy52aXNpYmxlT3JIaWRkZW5CdG4oKSwge1xuICAgICAgcGFzc2l2ZTogdHJ1ZSxcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBidG4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2J0bjtcbiAgfVxuXG4gIHZpc2libGVPckhpZGRlbkJ0bigpIHtcbiAgICB0aGlzLmJ0bi5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG5cbiAgICBpZiAod2luZG93LnBhZ2VZT2Zmc2V0ID49IHRoaXMucGFnZVlPZmZzZXQpXG4gICAgICB0aGlzLmJ0bi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5kaXNwbGF5O1xuICAgIGVsc2UgdGhpcy5idG4uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgfVxufVxuXG5uZXcgQnV0dG9uU21vb3RoU2Nyb2xsKHtcbiAgYnRuOiAnI2J0bi1zY3JvbGwnLFxuICBkaXNwbGF5OiAnZmxleCcsXG4gIHBhZ2VZT2Zmc2V0OiAyMDAsXG59KTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG5mdW5jdGlvbiByZXNwb25zZU1lc3NhZ2UoZWxlbSwgY29udGVudCwgY2xhc3NBY3RpdmUpIHtcbiAgZWxlbS50ZXh0Q29udGVudCA9IGNvbnRlbnQ7XG4gIGVsZW0uY2xhc3NMaXN0LmFkZChjbGFzc0FjdGl2ZSk7XG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc0FjdGl2ZSk7XG4gIH0sIDUwMDApO1xufVxuXG5mdW5jdGlvbiBmb3JtU3VibWl0KGZvcm0sIG1lc3NhZ2VCb3gsIGNsYXNzQWN0aXZlTWVzc2FnZSkge1xuICBsZXQgZGF0YSA9IHt9O1xuXG4gIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBmb3IgKGxldCBlbGVtIG9mIGUuY3VycmVudFRhcmdldC5lbGVtZW50cylcbiAgICAgIGlmIChlbGVtLm5vZGVOYW1lID09PSAnSU5QVVQnKSBkYXRhW2VsZW0ubmFtZV0gPSBlbGVtLnZhbHVlO1xuXG4gICAgZmV0Y2goJ2h0dHBzOi8vanNvbnBsYWNlaG9sZGVyLnR5cGljb2RlLmNvbS9wb3N0cycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcsXG4gICAgICB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaylcbiAgICAgICAgcmVzcG9uc2VNZXNzYWdlKFxuICAgICAgICAgIG1lc3NhZ2VCb3gsXG4gICAgICAgICAgJ9CS0LDRiNC4INC00LDQvdC90YvQtSDRg9GB0L/QtdGI0L3QviDQvtGC0L/RgNCw0LLQu9C10L3Riywg0L7QttC40LTQsNC50YLQtSDQtNCw0LvRjNC90LXQudGI0LXQuSDRgdCy0Y/Qt9C4INGBINC90LDQvNC4IScsXG4gICAgICAgICAgY2xhc3NBY3RpdmVNZXNzYWdlXG4gICAgICAgICk7XG4gICAgICBlbHNlXG4gICAgICAgIHJlc3BvbnNlTWVzc2FnZShcbiAgICAgICAgICBtZXNzYWdlQm94LFxuICAgICAgICAgICfQn9GA0L7QuNC30L7RiNC70LAg0L7RiNC40LHQutCwINC/0YDQuCDQvtGC0L/RgNCw0LLQutC1INC00LDQvdC90YvRhSwg0L/QvtCy0YLQvtGA0LjRgtC1INC00LDQvdC90YPRjiDQvtC/0LXRgNCw0YbQuNGOINC/0L7Qt9C20LUhJyxcbiAgICAgICAgICBjbGFzc0FjdGl2ZU1lc3NhZ2VcbiAgICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59XG4iXX0=
